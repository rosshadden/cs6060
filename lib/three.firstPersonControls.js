THREE.FirstPersonControls=function(a,b){this.object=a;this.target=new THREE.Vector3(0,0,0);this.domElement=(b!==undefined)?b:document;this.movementSpeed=1;this.lookSpeed=0.005;this.lookVertical=true;this.autoForward=false;this.activeLook=true;this.heightSpeed=false;this.heightCoef=1;this.heightMin=0;this.heightMax=1;this.constrainVertical=false;this.verticalMin=0;this.verticalMax=Math.PI;this.autoSpeedFactor=0;this.mouseX=0;this.mouseY=0;this.lat=0;this.lon=0;this.phi=0;this.theta=0;this.moveForward=false;this.moveBackward=false;this.moveLeft=false;this.moveRight=false;this.freeze=false;this.mouseDragOn=false;this.viewHalfX=0;this.viewHalfY=0;if(this.domElement!==document){this.domElement.setAttribute("tabindex",-1)}this.handleResize=function(){if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2}};this.onMouseDown=function(d){if(this.domElement!==document){this.domElement.focus()}d.preventDefault();d.stopPropagation();if(this.activeLook){switch(d.button){case 0:this.moveForward=true;break;case 2:this.moveBackward=true;break}}this.mouseDragOn=true};this.onMouseUp=function(d){d.preventDefault();d.stopPropagation();if(this.activeLook){switch(d.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false;break}}this.mouseDragOn=false};this.onMouseMove=function(d){if(this.domElement===document){this.mouseX=d.pageX-this.viewHalfX;this.mouseY=d.pageY-this.viewHalfY}else{this.mouseX=d.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=d.pageY-this.domElement.offsetTop-this.viewHalfY}};this.onKeyDown=function(d){switch(d.keyCode){case 38:case 87:this.moveForward=true;break;case 37:case 65:this.moveLeft=true;break;case 40:case 83:this.moveBackward=true;break;case 39:case 68:this.moveRight=true;break;case 82:this.moveUp=true;break;case 70:this.moveDown=true;break;case 81:this.freeze=!this.freeze;break}};this.onKeyUp=function(d){switch(d.keyCode){case 38:case 87:this.moveForward=false;break;case 37:case 65:this.moveLeft=false;break;case 40:case 83:this.moveBackward=false;break;case 39:case 68:this.moveRight=false;break;case 82:this.moveUp=false;break;case 70:this.moveDown=false;break}};this.update=function(k){if(this.freeze){return}if(this.heightSpeed){var j=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax);var h=j-this.heightMin;this.autoSpeedFactor=k*(h*this.heightCoef)}else{this.autoSpeedFactor=0}var e=k*this.movementSpeed;if(this.moveForward||(this.autoForward&&!this.moveBackward)){this.object.translateZ(-(e+this.autoSpeedFactor))}if(this.moveBackward){this.object.translateZ(e)}if(this.moveLeft){this.object.translateX(-e)}if(this.moveRight){this.object.translateX(e)}if(this.moveUp){this.object.translateY(e)}if(this.moveDown){this.object.translateY(-e)}var i=k*this.lookSpeed;if(!this.activeLook){i=0}var g=1;if(this.constrainVertical){g=Math.PI/(this.verticalMax-this.verticalMin)}this.lon+=this.mouseX*i;if(this.lookVertical){this.lat-=this.mouseY*i*g}this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=THREE.Math.degToRad(90-this.lat);this.theta=THREE.Math.degToRad(this.lon);if(this.constrainVertical){this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)}var f=this.target,d=this.object.position;f.x=d.x+100*Math.sin(this.phi)*Math.cos(this.theta);f.y=d.y+100*Math.cos(this.phi);f.z=d.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(f)};this.domElement.addEventListener("contextmenu",function(d){d.preventDefault()},false);this.domElement.addEventListener("mousemove",c(this,this.onMouseMove),false);this.domElement.addEventListener("mousedown",c(this,this.onMouseDown),false);this.domElement.addEventListener("mouseup",c(this,this.onMouseUp),false);this.domElement.addEventListener("keydown",c(this,this.onKeyDown),false);this.domElement.addEventListener("keyup",c(this,this.onKeyUp),false);function c(e,d){return function(){d.apply(e,arguments)}}this.handleResize()};
